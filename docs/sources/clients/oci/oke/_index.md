---
title: OKE
weight: 80
---
# Sending logs from OKE with Promtail

This tutorial walks through necessary steps for exporting application logs from Oracle Container Engine for Kubernetes ([OKE]) with Promtail. OKE is a fully managed, scalable, and highly available service that you can use to deploy your containerized applications to Oracle Cloud. After this tutorial, you will be able to query all your logs in one place using Grafana.

## Requirements

Before we start, you need:

- The [OCI CLI][oci cli] installed.
- The [kubectl CLI][kubectl] installed.

## Setting up the OKE cluster

Before setting up the cluster, check the list of compute [shapes] available for the OKE worker nodes. It's recommended to have a cluster with at least 4 OCPUs and 30GB of RAM. To provision your OKE cluster, follow the instructions [here]. 

Once your OKE cluster is created, verify you can connect to it.

```bash
kubectl get nodes
```
![](/assets/image1.png)

## Install Grafana Loki and Prometheus

Follow the [general process] instructions to install Loki, Grafana, and Prometheus. 

![](/assets/image2.png)

## Install Promtail

To send logs generated by your pods, you need to set up Promtail as a DaemonSet in your cluster. This means it runs on each OKE worker node of the cluster. You then need to configure it to find the logs of your containers on the host. Promtail uses the same service discovery as Prometheus.

Make sure the `scrape_configs` of Promtail matches the Prometheus one. It is simple to configure, and it also means Metrics and Logs have the same metadata (labels) attached by the Prometheus service discovery. Then, when querying Grafana, you are able to correlate metrics and logs very quickly. (Read more about [it] here).

Create Loki values:

```bash
cat > values.yaml <<EOF
loki:
  serviceName: "loki.mycompany.biz”
  servicePort: 443
  serviceScheme: https
  user:  
  password: 
EOF
```
Once you’re ready, create a new namespace monitoring and add Promtail to it:

```bash
kubectl create namespace monitoring

helm install promtail --namespace monitoring grafana/promtail -f values.yaml
```
Verify that Promtail pods are running. 
```bash
kubectl get -n monitoring pods
```
![](/assets/image3.png)

You can reach your Grafana instance and start exploring your logs. For example, if you want to see all logs in the monitoring namespace use {namespace="monitoring"}. You can also expand a single log line to discover all labels available from the Kubernetes service discovery.

![](/assets/image4.png)

## Conclusion

At this point Grafana Loki, Prometheus, Promtail, and its UI should be installed, configured, and reachable through the IP address. That's it! You can use Grafana Loki with Promtail to store and query logs from all your OKE cluster applications and infrastructure.

[oke]: https://docs.oracle.com/en-us/iaas/Content/ContEng/Concepts/contengoverview.htm 
[oci cli]: https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/cliinstall.htm?target=_blank
[kubectl]: https://kubernetes.io/docs/tasks/tools/install-kubectl/ 
[shapes]: https://docs.oracle.com/en-us/iaas/Content/ContEng/Reference/contengimagesshapes.htm#shapes 
[here]: https://docs.oracle.com/en-us/iaas/Content/ContEng/Tasks/contengcreatingclusterusingoke.htm
[general process]: https://grafana.com/docs/loki/latest/installation/
[it]: https://grafana.com/blog/2020/03/31/how-to-successfully-correlate-metrics-logs-and-traces-in-grafana/
